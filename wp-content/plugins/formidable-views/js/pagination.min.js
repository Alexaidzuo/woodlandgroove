(function(){if("function"!==typeof document.addEventListener||!Element.prototype.matches)return;document.addEventListener("click",handleClickEvents);document.addEventListener("scroll",handleScrollEvents);function handleClickEvents(event){var target=event.target;if("A"!==target.nodeName||!getPaginationContainerFromChild(target))return;event.preventDefault();handlePageClick(target)}function handlePageClick(target){var paginationContainer,href,hrefSplit,pageKey,viewId,viewElements,comment,page;paginationContainer=
getPaginationContainerFromChild(target);if(!paginationContainer)return;if(hasClass(target,"frm-ajax-pagination-load-more")){loadInfiniteScroll(target);return}href=target.href;pageKey=false;hrefSplit=href.split("?");if(hrefSplit.length>=2)each(hrefSplit[1].split("&"),function(param){var split=param.split("=");if(0===split[0].indexOf("frm-page-")){pageKey=param;page=parseInt(split[1])}});if(!pageKey)return;viewId=parseInt(pageKey.replace("frm-page-",""));viewElements=[];comment=loopPreviousSiblingsUntilComment(paginationContainer,
function(previousSibling){viewElements.push(previousSibling)});loadPage(viewId,page,comment,handlePageHtml);function handlePageHtml(html){if(viewElements.length){paginationContainer.insertAdjacentHTML("beforebegin",html);each(viewElements,maybeRemove)}maybeRemove(paginationContainer);setQueryStringParameter("frm-page-"+viewId,page)}}function loopPreviousSiblingsUntilComment(element,handleSibling){var previousSibling,comment;previousSibling=element.previousSibling;comment=false;while(previousSibling){if("function"===
typeof handleSibling&&false===handleSibling(previousSibling))break;comment=checkElementForComment(previousSibling);if(false!==comment)break;previousSibling=previousSibling.previousSibling}return comment}function checkParagraphForViewComment(p){var comment=false;each(p.childNodes,function(node){if(nodeIsViewComment(node)){comment=node;return false}});return comment}function nodeListToArray(nodeList){var index,length,result;length=nodeList.length;result=[];for(index=0;index<length;++index)result.push(nodeList[index]);
return result}function nodeIsViewComment(node){return node&&"#comment"===node.nodeName&&-1!==node.nodeValue.indexOf("FRM-VIEW")}function maybeRemove(element){if(element.parentNode)element.parentNode.removeChild(element)}function getPaginationContainerFromChild(child){return getClosestParent(child,".frm_ajax_pagination_cont")}function handleScrollEvents(){var loadMoreButtons=document.getElementsByClassName("frm-ajax-pagination-load-more");if(!loadMoreButtons.length)return;each(loadMoreButtons,function(trigger){if(!hasClass(trigger,
"frm-infinite-scroll")||trigger.getBoundingClientRect().bottom>window.innerHeight)return;loadInfiniteScroll(trigger)})}function loadPage(viewId,page,comment,callback){var url,xhr,params;url=frmViewsPaginationVars.ajaxurl+"?action=frm_views_load_page&frm-page-"+viewId+"="+page;xhr=new XMLHttpRequest;xhr.open("post",url,true);xhr.onreadystatechange=handleReadyStateChange;xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
params="id="+viewId;if(false!==comment)params+="&frm_view_page_state="+encodeURIComponent(getStateFromComment(comment));if("__FRMTABLES"in window&&undefined!==__FRMTABLES.graphs)params+="&frm_graph_offset="+__FRMTABLES.graphs.length;xhr.send(params);function handleReadyStateChange(){var json,newGraphData;if(requestIsSuccessful(xhr)){json=JSON.parse(xhr.responseText);callback(json.html);if(undefined!==json.graphs){if("__FRMTABLES"in window){newGraphData=JSON.parse(JSON.stringify(window.__FRMTABLES));
if(undefined!==json.graphs.graphs)each(json.graphs.graphs,function(graph){newGraphData.graphs.push(graph)})}else newGraphData=json.graphs;__FRMTABLES=newGraphData;frmProForm.loadGoogle()}}}}function setQueryStringParameter(name,value){if("function"!==typeof URLSearchParams)return;var params=new URLSearchParams(window.location.search);params.set(name,value);window.history.replaceState({},"",decodeURIComponent(window.location.pathname+"?"+params))}function getStateFromComment(comment){var text,start,
end;text=comment.nodeValue;start=text.indexOf('state="');if(-1===start)return"";start+=7;end=text.indexOf('"',start+1);return text.substring(start,end)}function requestIsSuccessful(xhr){return xhr.readyState>3&&xhr.status==200&&xhr.responseText!==""}function loadInfiniteScroll(trigger){var viewId,page,paginationContainer,comment,previousSibling;if(hasClass(trigger,"frm-loading-infinite-scroll"))return;viewId=parseInt(trigger.getAttribute("frm-view-id"));page=parseInt(trigger.getAttribute("frm-page"))+
1;paginationContainer=getPaginationContainerFromChild(trigger);if(hasClass(trigger,"frm-table-type")){loadInfiniteScrollForTable({trigger:trigger,viewId:viewId,page:page,paginationContainer:paginationContainer});return}if(hasClass(trigger,"frm-grid-type")){loadInfiniteScrollForGrid({trigger:trigger,viewId:viewId,page:page,paginationContainer:paginationContainer});return}comment=loopPreviousSiblingsUntilComment(paginationContainer);trigger.className+=" frm-loading-infinite-scroll";loadPage(viewId,
page,comment,function(html){var wrapper,pTagParent,callback;wrapper=document.createElement("div");wrapper.innerHTML=html;replaceTrigger(wrapper.querySelector(".frm-ajax-pagination-load-more"),trigger);if("P"===comment.parentNode.nodeName){pTagParent=comment.parentNode;callback=function(child){pTagParent.parentNode.insertBefore(child,pTagParent.nextSibling)}}else callback=function(child){comment.parentNode.insertBefore(child,comment)};each(nodeListToArray(wrapper.childNodes),function(child){if(hasClass(child,
"frm_pagination_cont")&&!child.children.length)return;callback(child)});maybeRemove(comment);if(!paginationContainer.children.length)maybeRemove(paginationContainer)})}function replaceTrigger(newTrigger,oldTrigger){if(newTrigger)oldTrigger.parentNode.insertBefore(newTrigger,oldTrigger);maybeRemove(oldTrigger)}function loadInfiniteScrollForTable(args){var table,comment;table=checkBeforePaginationContainerForTable(args.paginationContainer);if(false===table)return;comment=loopPreviousSiblingsUntilComment(table);
args.trigger.className+=" frm-loading-infinite-scroll";loadPage(args.viewId,args.page,comment,function(html){var wrapper,tbody;wrapper=document.createElement("div");wrapper.innerHTML=html;tbody=table.querySelector("tbody");replaceComment(checkWrapperForComment(wrapper),comment);replaceTrigger(wrapper.querySelector(".frm-ajax-pagination-load-more"),args.trigger);each(wrapper.querySelectorAll("tbody tr"),function(row){tbody.appendChild(row)})})}function checkBeforePaginationContainerForTable(paginationContainer){return checkBeforePaginationContainerForMatch(paginationContainer,
function(element){return"TABLE"===element.nodeName})}function checkBeforePaginationContainerForGrid(paginationContainer){return checkBeforePaginationContainerForMatch(paginationContainer,function(element){return hasClass(element,"frm-grid-view")})}function checkBeforePaginationContainerForMatch(paginationContainer,callback){var match=false;loopPreviousSiblingsUntilComment(paginationContainer,function(previousSibling){if(callback(previousSibling)){match=previousSibling;return false}});return match}
function checkWrapperForComment(wrapper){var element=wrapper.firstChild;return checkElementForComment(element)}function checkElementForComment(element){if(!element)return false;if("P"===element.nodeName)return checkParagraphForViewComment(element);if(nodeIsViewComment(element))return element;return false}function replaceComment(newComment,oldComment){if(newComment)oldComment.parentNode.insertBefore(newComment,oldComment);maybeRemove(oldComment)}function loadInfiniteScrollForGrid(args){var grid,comment;
grid=checkBeforePaginationContainerForGrid(args.paginationContainer);if(false===grid)return;comment=loopPreviousSiblingsUntilComment(grid);args.trigger.className+=" frm-loading-infinite-scroll";loadPage(args.viewId,args.page,comment,function(html){var wrapper=document.createElement("div");wrapper.innerHTML=html;replaceComment(checkWrapperForComment(wrapper),comment);replaceTrigger(wrapper.querySelector(".frm-ajax-pagination-load-more"),args.trigger);each(nodeListToArray(wrapper.querySelector(".frm-grid-view").children),
function(row){grid.appendChild(row)})})}function hasClass(element,targetClass){var className=" "+element.className+" ";return-1!==className.indexOf(" "+targetClass+" ")}function getClosestParent(element,selector){var activeParent=element.parentNode;while(activeParent&&"function"===typeof activeParent.matches){if(activeParent.matches(selector))return activeParent;activeParent=activeParent.parentNode}return false}function each(items,callback){var index,length;length=items.length;for(index=0;index<length;index++)if(false===
callback(items[index],index))break}})();
